# 하드웨어와 네트워크 인터페이스 계층

네트워크 인터페이스 계층은 TCP/IP 계층 모델중 가장 아래에 있다. 네트워크 어댑터와 같이 하드웨어와 맞닿은 부분까지 혹은 경우에 따라서는 하드웨어까지 포함해서 네트워크 인터페이스 계층이라고 말한다.네트워크의 하드웨어 부분이라고하면 유선 LAN,무선 LAN과 같은 다양한 것들이 있는데, 이러한 하드웨어들을 제어하면서 인접한 통신 기기까지 데이터를 전달하는 것이 네트워크 인터페이스 계층의 역할이다. 다르게 표현하자면, 통신할 상대 기기까지 데이터를 전달하는 것이 네트워크 인터페이스 계층의 역할이다. 다르게 표현하자면 통신할 상대 기기까지 데이터를 전달하고 나면 이 계층이 할 일은 끝난다는 말이기도하다. 물론, 데이터를 받은 상대기기에도 자신의 네트워크 인터페이스 계층이 있어서 상위 계층과의 또 다른 처리가 이루어지겠지만, 이 과정은 엄연히 독립된 장비에서 이루어지는 일이기 때문에 별도로 생각해도 무방하다. 바로 위 계층에 위치한 인터넷 계층이 원거리의 통신 경로를 거쳐 데이터를 가져오는 것에 반해 네트워크 인터페이스 계층은 상대적으로 짧은 구간에 데이터를 전달하는 셈이다.
네트워크 인터페이스 계층은 여행할 때 목적지까지 가기위해 교통수단을 갈아타는 것에 비유할 수 있다. 승객은 지하철이나 버스, 비행기등으로 환승하면서 목적지까지 이동하게 되는데, 이때 이용하는 각 교통수단은 자신이 운행하는 구간만 알고 있을 뿐 환승하는 다른 교통수단이 어떻게 운행하는지 신경쓰지 않는다. 이와 비슷하게 네트어크 인터페이스 계층도 인접하는 기기까지만 데이터를 전달하는데 집중하도록 만들어져있다. 이후 최종 목적지까지 데이터가 도달되도록 행선지를 정하는 것은 인터넷 계층이 하는 일이므로 네트워크 인터페이스 계층은 이후의 일에 대해서는 신경쓰지 않는다.

## 네트워크 인터페이스 계층의 역할

네트워크 인터페이스 계층은 하드웨어를 제어하는 부분이다. 여기서 말하는 하드웨어는 네트워크 어댑터나 LAN케이블, 광케이블등을 포함한다. 이런 하드웨어를 제어하면서 상위의 인터넷 계층이 하위의 하드웨어 동작에 대해서는 신경쓰지않고 동작할 수 있도록 만들어주는 것이 네트워크 인터페이스 계층의 역할이다. 참고로 OSI참조모델에서는 프로토콜과 같이 소프트웨어와 관련된 부분을 데이터 링크계층이라고 하고 하드웨어와 관련된 부분을 물리계층 이라고 한다. 상위 계층은 하드웨어의 종류에 상관없이 통신할 수 있도록 만들어져있고 네트워크 인터페이스 계층은 데이터를 전달하기위해 전기신호 전파 광신호등의 다양한 방법을 이용한다.
네트워크 인터페이스 계층의 프로토콜중에는 전화회선을 사용해서 원격지와 접속하는 PPP와 동축케이블이나 UTP케이블을 사용하는 이더넷같은 프로토콜이 있다. 이 외에도 IP어드레스 정보를 이용하여 목적지의 MAC어드레스를 알아내는 ARP프로토콜도 있다.
네트워크 통신에 사용되는 하드웨어들은 장비간의 접속방식이나 신호를 주고받는 방식등이 다양한데, 이러한 내용은 각종사양이나 규정에 정의되어있다.
트랜스포트 계층과 인터넷 계층에서 사용하는 TCP/IP 는 특정 하드웨어에 의존하지 않도록 설계되어있다. 반면, 네트워크 인터페이스 계층은 하드웨어와 떼려야 뗄 수 없는 관계이다. 그래서 이더넷과 같은 기술에서는 소프트웨어 사양과 하드웨어 사양이 함께존재한다.

## MAC 어드레스

네트워크 어댑터(NIC, Network Interface Card)에는 MAC(Media Access Control) 어드레스라고 하는 식별 번호가 부여되어 있다. 이 식별번호는 제조사가 제조 단계에서 붙이는 것으로, 퍼블릭 IP어드레스와 비슷하게 전 세계의 네트워크 장비들이 서로 구분될 수 있도록 할당된다.
MAC어드레스는 유선 LAN의 이더넷이나 무선 LAN외에도 단거리 통신에 사용되는 블루투스와 같은 다양한 데이터 통신에 활용된다. 네트워크 인터페이스 계층이 보내는 데이터를 프레임이라고 하는데, 이 프레임 안에 송신지와 수신지의 MAC어드레스 정보가 들어간다.
MAC어드레스의 역할은 데이터를 전달할 목적지를 가리킨다는 점에서 IP어드레스와 유사하다. 다만, IP어드레스는 최종 목적지가 한번 설정되면 전송과정에서 변경되지 않지만 MAC어드레스는 전송 과정 중에 통신 경로상에 다음 장비의 어드레스로 교체된다는 점이 다르다.
MAC어드레스는 최종목적지가 아닌 바로 다음 목적지를 가르킨다.

## 이더넷

이더넷은 현재 가장많이 사용되는 유선 LAN의 규격으로 기술이 발전함에 따라 점점 더 많은 데이터를 고속으로 처리할 수 있게 개선되고있다.
유선 LAN은 통신장비끼리 케이블로 연결하게 되는데, 이때 이더넷이라는 규격을 사용한다. 통신속도나 접속 방식에 따라 100BASE-TX나 1000BASE-T와 같은 세부 규격이 존재한다.
주파수가 높은 신호는 쉽게 감쇠하기 때문에 전송속도가 고속인 규격에서는 가능한 한 주파수가 높아지지 않도록 제한하는 대신 케이블 자체를 고급사양으로 사용한다.
수신측의 네트워크 어뎁터는 전압의 높낮이가 변화하는 신호를 받아 0과 1의 디지털신호로 복호화한다. 이때 전압이 변화하는 타이밍에 맞춰 신호를 분석하려면 어디부터가 시작인지 기준점을 알아야한다. 그래서 프레임 앞부분에는 프리앰블이라고 하는 패턴을 두어 신호의 시작을 알수 있도록 만들어져있다.

## 네트워크 허브

이더넷에서는 L2,L3 스위치와 같은 네트워크 허브를 중계기기로 사용한다.
유선 LAN에서는 네트워크 허브라는 장비에 케이블을 연결해서 네트워크를 구성한다. 일반 가정에서는 인터넷 서비스 업체에서 입대한 초고속 인터넷 라우터를 사용하는 것이 일반적인데, 이 단말기에는 네트워크 허브 기능이 내장되어있다. 네트워크 허브에는 리피터 허브, L2스위치, L3스위치등이있다.
L2스위치 혹은 스위칭허브는 오늘날 가장 많이 사용되는 네트워크 중계기기다. L2는 OSI참조 모델의 데이터 링크 계층을 의미하고 TCP/IP모델에서는 네트워크 인터페이스 계층에 해당한다. L2스위치는 포트에 연결된 각 호스트의 MAC어드레스를 기억해 두었다가 통신할 당사자 간에만 데이터를 전달하기 때문에 통신 과정에서 다른 호스트가 보내는 패킷 신호와의 충돌을 피할 수 있다. L2스위치를 사용하면 통신 회선이 통신 당자자 간에만 독립적으로 만들어지기 때문에 여러 통신이 동시에 이루어지더라도 패킷 충돌이 발생하지 않는다.
브로드캐스트 도메인이란 수신지의 주소가 브로드캐스트 어드레스일 때 데이터가 전달되는 범위를 의미한다. 그래서 L2스위치로 네트워크를 구성하였다면 네트워크 전체가 브로드캐스트 도메인이 된다.만약 네트워크에 연결된 호스트의 수가 많을 경우 DHCP나 OS의 파일 공유와 같은 브로드캐스트 통신이 자주 사용되면 네트워크 내에 대량의 패킷이 발생해서 망이 혼잡해질 수도 있다.
L3스위치는 OSI참조 모델중 네트워크 계층에 해당하고 TCP/IP모델에서는 인터넷 계층의 기능까지 수행할 수 있는 장비이다. L3스위치의 대표적인 기능으로는 VLAN(Virtual LAN)을 꼽을 수가 있는데, 이 기능은 LAN을 몇개의 가상적인 네트워크로 분할해서 통신효율을 높이기 위해 사용한다. VLAN을 구성하면 브로드 캐스트 패킷을 VLAN호스트 범위로만 제한하여 전달할 수 있다.

## 무선 LAN

무선 LAN은 전파를 통신 매개체로사용하여 네트워크를 구성한다.
전파를 이용해서 네트워크를 구성하는 무선 LAN의 정식 규격명은 IEEE 802.11이다. 무선 LAN에서는 다른 통신 장비가 전파를 발신하고 있지 않은 것을 확인한후 통신을 시작하는 CSMA/CA(Carrie Sense Multiple Access with Collision Avoidance)라는 방식을 사용한다.
이더넷과 마찬가지로 무선 LAN에서도 통신할 때 주고받는 데이터를 프레임 이라고 한다. 다만 무선 LAN의 프레임에는 MAC어드레스 필드가 4개나 되는데, 무선 LAN끼리 통신하는 경우와 무선 LAN뒤에 유선 LAN이 연결되는 경우 등에 따라 MAC 어드레스 정보가 할당되는 방식이 달라진다.
무선 LAN의 통신에는 송신지와 수신지 사이를 무선 AP가 중계하게 된다. 그래서 프레임에는 송신지와 수신지의 MAC어드레스 외에도 무선AP의 MAC어드레스 정보도 들어간다.

## ARP

ARP는 IP어드레스 정보를 이용하여 해당 장비의 MAC어드레스를 알아내는 프로토콜이다.
이더넷이나 무선 LAN으로 데이터를 보내려면 수신측의 MAC어드레스를 알고 있어야 한다. 이때 필요한 것이 ARP(Address Resolution Protocol)인데, 송신측 장비는 요청 패킷에 수신측의 IP어드레스를 설정한후 네트워크 전체에 브로드캐스트한다. 이어 이 요청을 받은 호스트들 중 수신지의 IP어드레스가 자신의 IP어드레스와 동일한 장비는 자신의 MAC어드레스를 응답패킷에 설정하여 응답하게된다. 결국 송신지 장비는 수신지 장비의 IP어드레스 정보를 사용하여 MAC어드레스도 알 수 있게 된다.
ARP헤더에는 MAC어드레스를 물어보는 송신지의 어드레스 정보와 MAC어드레스를 알수 없는 목적이의 어드레스를 담을 수 있는 필드가 있다. 헤더내의 오퍼레이션 코드가 1인경우는 요청을 의미하고, 2인경우는 응답을 의미한다.
대리 ARP혹은 프락시(proxy)는 호스트 대신 라우터가 ARP에 대해 응답하는 기능을 말한다. 서브넷 마스크 값이 다른 호스트가 있을 때 이 기능이 필요한데, 통상적인 ARP요청은 같은 네트워크 내에 있는 호스트들에게는 브로드캐스팅되는 반면, 서브넷 마스크가 다른 호스트에는 전달되지 않기 때문이다. 그래서 그 사이에 있는 라우터가 프락시 ARP기능으로 자신의 MAC어드레스를 대신응답하여 데이터를 중계할 수 있게 만든다.

## arp명령으로MAC어드레스 알아내기

IP어드레스만 알고 MAC어드레스를 모를 때는 ARP를 사용하면 된다. 같은 IP어드레스에 대해 매번MAC어드레스를 요청하는 것은 불필요한 시간 낭비가 발생할 뿐만 아니라, 요청할 때마다 발생하는 브로드 캐스트 때문에 네트워크가 혼잡해질 수 있다. 그래서 한번 확인한 MAC어드레스는 요청한 컴퓨터에서 일정 시간 보관하여 캐시기능을 하게 되어있다. 만약 캐쉬된 MAC어드레스의 목록을 확인하고 싶다면 arp명령으로 확인할 수 있다.
