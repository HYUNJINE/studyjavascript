대량의 데이터를 저장하고 관리하기 위해 개발자들은 데이터베이스 관리 시스템을 만들어 활용한다. 용어만 놓고보면 어려운것 같지만, 실은 도서관의 이용규칙처럼ㅁ 컴퓨터도 데이터가 들어가고 나오기위한 소프트웨어 도구의 집합을 DBMS라고 부른다. 그렇다면 DBMS는 정보를 저장하고 관리하는데 있어서 어떤 역할을 수행할까?

- 정의: 형식 구조 제약을 통해 데이터를 균일하게 관리하도록 도와준다.
- 구축: 관리하는 정보를 기억장치에 저장해준다.
- 조작: 질의 및 다른 기능을 통해 데이터를 독립적이고 효율적으로 접근하게 해준다. 
- 공유: 데이터에 동시에 접근할 수 있게 해준다.
- 보호: 보안을 유지하고 충돌을 복구할 수 있게 해준다.
- 유지보수: 시간이 지나면서 요구사항을 반영할 수 있게 해준다.

MongoDB는 앞서 언급한 데이터의 구축과 조작을 비관계형이라는 방식으로 관리하는 DBMS이다.

NoSQL DBMS 에 대해서는 다양한 정의가 있지만 기존의 관계형 DBMS가 아닌것이라고 생각하면 이해하기 쉽다.
MongoDB또한 여러가지 특징들이 기존의 관계형 DBMS들과는 많이 다르기 때문에 NoSQL DBMS로 불리고 있다. 뛰어난 확장성,성능.

몽고디비는 자바스크립트를 이용해서 질의한다. 또한 MongoDB는 개발자 중 많은 숫자를 차지하고 있는 프론트엔드 개발자에게 생소한 SQL대신 js를 활용 할 수 있어, 기술을 처음 배우는 사람의 부담을덜어준다.

더불어 MongoDB는 관계형 DBMS에서 테이블을 이용해 정보를 저장하는 방식과달리 웹서버와 통신할 때 자주쓰이는 JSON과 유사한 형태로 저장하는 방식을 채용한다.

몽고디비는의 구조는 테이블 구조와는 다르게 어떤 값을 가질지, 크기는 얼마나 될지를 미리 정하지 않고 데이터를 저장할 수 있다. 

몽고디비는 도큐먼트 지향 스토어 방식을 사용하기 때문에 어떤 값을 가질지, 크기는 얼마나 될지를 미리 정하지 않고 데이터를 저장할 수 있다. 이런 특징이 몽고디비를 이용해서 개발할 때 빠르게 변화하는 애플리케이션의 요구를 더 쉽게 수용하고 구조를 바꿀 수 있게 만들어서 개발자가 데이터베이스 구조를 고민하는데 쓸 시간과 노력을 절약해준다는 장점이있다.

몽고디비의 또하나의 큰 장점은 바로 복제와 샤딩을 기본적인  DBMS의 기능으로 제공하고있다는 점이다. 데이터베이스의 복제란 무엇이고 언제 필요한 걸까 이를테면 무료 송금 애플리케이션을 개발하는데 계좌정보를 몽고디비에 저장한다고 해보자. 그런데 데이터베이스 서버가 정전이 일어나서 송금시스템이 통째로 멈추어 버리면 어떤 일이 벌어질까? 디비가 갑자기 애플리케이션과 통신이 끊기든지, 통신하던  DBMS가 들어있는 데이터센터의 전기가 나가버렸을 때 스스로 복제된 데이터베이스가 있다면 이것들을 연결시켜서 데이터 흐름을 복구할 수 있다.

데이터베이스에 저장된 정보의 양이 많아지고 읽고쓰는 양이 많아지면 필연적으로 데이터베이스가 주어진 작업을 수행하는 속도가 느려진다. 이런 상황에서 데이터를 읽고쓰는 속도를 향상시키는 방법중 하나가 정보를 분산해서 여러대의 서버데이터베이스에 저장하는 것이다. 이렇게 분산해서 정보를 저장하는 방식을 샤딩이라고한다. 몽고 디비는 기존 관계형 데이터베이스의 규칙을 엄격하게 적용하지 않았기 때문에 복제와 샤딩을 DBMS상에서 제공하는 기능만으로 쉽게 구성가능하다. 


## 1.2 언제 써야할까?

스키마가 자주 바뀌는 환경

스키마란 어떤 종류의 정보를 어떤 구조에 어떤 관계를 가지고 있는지 정의한 구조를 말하낟. 스키마의 구조를 어떻게 구성하는지에 따라 데이터베이스의 효율성이 달라지기도하고, 개발자가 자료가 저장된 구조를 더 잘 이해할 수 있기도 하다.

애자일 개발 방법론이나 나선형 모델의 시제품을 만들 때와같이 최종적인 개발 명세가 확정되지 않은 상황

물론 최종적을 개발이 완료되고 난 후에는 결정된 스키마가 명료하고, 이해하기 쉽고, 성능상 효율성을 고려한 형태가 되어야한다. 몽고디비는 단순히 로깅을 위한 용도로 사용할 수있다. 몽고디비는 스키마가 없는 구조로 되어있기 때문에 다양한 형식의 로그를 기록할 때도 매우 용이하다.

분산 컴퓨팅 환경

몽고디비는 상대적으로 큰 노력을 들이지않고 여러대의 서버에 데이터베이스를 나누는 분산 컴퓨팅 환경을 만들 수있다. 샤딩과 복제를 DBMS수준에서 지원해서 여러 관련 기능들을 보다 효과적으로 적용할 수 있다. 그렇다면 샤딩과 복제가 필요한 순간은 언제일까?

복제는 고가용성환경이 필요할 때 고려해볼만하다. 고가용성이란 항상 사용할 수 있는 상태를 말하는데, 쉽게말하면 다양한 상황에서도 원하는 데이터를 얻는 환경이라고 할 수 있다. 마치 오뚝이를 넘어트려도 잠시동안 흔들릴뿐 다시 중심을 잡고 우뚝 서는 것처럼 복제를 이용하면 데이터베이스가 연결이 끊기거나 망가지는 극단적인 상황에서도 결과적으로 멈추지 않고 지속할 수 있게한다. MongoDB는 복제된 서버로부터 읽기 기능을 하도록 설정할 수 있기 때문에 만약 내 서비스가 읽기 속도가 많이 필요하다면, 복제를 통해 읽기 속도를 향상시키는 방법도 사용할 수 있다. 

샤딩은 저장 용량이 늘어나면서 읽기 쓰기 속도가 필요한 만큼 나오지 않을 때 고려할 수 있다. 흔히 서비스의 사용자가 많이 늘어난 상황일 때 이러 ㄴ경우가 많다. 내가 개발하는 서비스가 갑자기 잘되었다고 가정해보자 데이터베이스는 사용자가 늘어나 저장용량이 늘어나고 늘어난 만큼 읽기 쓰기 작업이 많아진다. 곧 서비스가 느려지고 이용자는 실망하고 이내 떠난다. 

`mongod`

mongod 는  mongodb의 주요 데몬 프로세스로 코어데이터베이스 서버를 구동시킨다. 

mongo명령어를 입력하면 이제 몽고 셸에 접속한다.

mongodb의 셸은 자바스크립트로 명령을 전달하게된다. 앞으로 진행하게될 mongo shell 에 대한 실습은 항상 이 터미널 창을 이렇게 세팅한 상태에서 진행한다.

과거 ubuntu에 mongodb를 설치하면 mongod 서비스 서버가 켜져있을 때 자동적으로 실행이 되었다. 하지만 최근에는 mongod 서비스를 실행하면 다음과같은 에러가 발생한다.

```
$ sudo service mongod start
mongod: unrecognized service
```

etc/init.d 폴더에 mongod 인스턴스를 실행시키는 서비스 파일이 없으면 이런 에러가 발생하낟. 그렇다고 매번 서버를 킬 때마다 MongoDB를 실행 할 수는 없다. 특히 배포 환경에서 MongoDB가 서비스로 등록되어있지 않다면 매우 불편한 상황이 발생한다.

```
$ sudo apt-get install curl
```

```
$ curl -o /etc/init.d/mongod
https://raw.githubusercontent.com/mongodb/mongo/master/debian/init.d
$ chmod 755 /etc/init.d/mongod
```

```
systemctl enable mongod
$ sudo service mongod start
```

## 1.4 MongoDB의 구조

도큐먼트 컬렉션


몽고디비는 데이터베이스안에 컬렉션, 컬렉션안에 도큐먼트가 들어있는 구조로 되어있다. 앞선 그림처럼 데이터베이스가 문서를 저장하는 캐비닛이라면  컬렉션은 문서를 담은 서류 묶음이고, 도큐먼트에 실질적인 데이터가 적혀 있다고 생각하면된다.

본인의 애플리케이션에 회원에 대한 정보를 저장해야하고 해당 회원이 적을 게시글에 대한 정보도 저장해야한다고 가정하자. 만약 컬렉션이 없다면 하나의 데이터베이스에 회원에 대한 도큐먼트와 회원이 쓴 글에대한 도큐먼트가 서로 한 곳에 모여 복잡하게 된다. 컬렉션은 이런 정보를 각각의 종류 대로 묵어서 한곳에 모아두는 역할을 한다. 디비도 컬렉션과 마찬가지로 컬렉션을 묶어주는 역할을한다. 이제 정보를 담고있는 도큐먼트의 구조를 좀더 구체적으로 살펴보자. 도큐먼트는 JSON과 유사한 BSON형태로 되어있다. Binary JSON 구조는 필드와 값을 가지는데 앞선그림과 같이 필드에는 뒤에오는 값이 어떤정보인지를 담고있다. 필드와 필드 사이는 쉼표로 구분하고 도큐먼트 하나는 중괄호로 감싸져있다. 필드에는 문자열만 들어가지만 값에들어갈 수 있는 형식에는 배열, 숫자 3차원 위치 좌표부터 필드와 값을 가지는 또 다른 오브젝트도 값으로 가질  수 있다. 

```
use testDB
db.myCollection.insertOne({x: 1})
```

셸에서 db라는 변수에는 현재 세팅된 데이터베이스가 저장되어있다. 현재 상황에서는 db는 testDB를 의미한다. insertOne 명령어는 testDB와 myCollection 이 없으면 생성하게 되고, 그안에 도큐먼트를 넣는다.

```
db 
show dbs
show collections
```

mongodb 셸은 자바스크립트를 따르기 때문에 //표시는 컴퓨터는 읽지 않고 사람만 읽을 수 있는 주석을 사용할 수 있다. 앞서 주석으로 설명한 명령어 세가지를 이용하면 데이터베이스와컬렉션에대한 정보를 알 수 있다. 

## 1.5 데이터 타입 

BSON 구조의 다양한 데이터타입

null은 아무것도 없다는 의미 정수형 실수형 문자열 Object Array Boolean

오브젝트의 경우 몽고디비에서는 임베디드 도큐먼트라고도 불린다. 도큐먼트 내부의 값으로 도큐먼트를 갖는 것이다. 

배열의 경우 여러개의 요소를 내부에 담을 수 있는데, 이요소의 값으로 여러가지 자료형을 가질 수 있다. 특히 앞서말했던 오브젝트의자료형도 가질 수 있어서 배열 안에 여러개의 도큐먼트를 저장하는 것이 가능하다. 이런 형식을 배열속 임베디드 도큐먼트라고 부른다. 

타임스탬프

BSON에는 시간을 나타내는 타입이 두가지있는데 하나는 타임스탬프 하나는 날짜이다. 하나의 몽고디비에서 같은 타임스탬프는 존재할 수 없다. 두번째인자가 다르다. 애플리케이션에서 시간을 저장하고자 한다면 날짜 타입을 사용하는 것이 바람직하다.

날짜

날짜타입은 64비트 정수형 숫자를 저장해서 기록하는데 저장된 숫자는 유닉스 시간을 의미한다. MongoDB셸에서는 ISODate 라는 객체로 표시되는데 날짜와 시간을 눈으로 구분할 수 있게 출력한다.

```js
let a = new Date()

ISODATE("2021-11-15T04:45:43.345Z")
a.getDay()
4

```

앞선 에시는 mongodb 셸에서 date오브젝트를 생성했을 때 출력되는 값을 보여준다.

Date 객체를 생성하면 ISODate 객체로 자동적으로 교체된다. ISODate객체는 javascript에서 date 객체와 똑같이 행동하기 때문에 날짜와 관련된 문법은 javascript의 date 객체 관련 문법을 참고하면된다. 
<!-- someone you loved  -->
<!-- when the day bleeds  -->
<!-- when you love someone 
you probably love someone like i do  -->