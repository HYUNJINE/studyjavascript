쿼리는 우리말로 질의라는 의미를 가진다. 


## 3.1 쿼리의 구조

몽고 디비의 쿼리는 오브젝트로 작성한다. 따라서 상대적으로 가독성이 떨어진다. 쿼리를 작성할 때 헷갈리지 않으려면 쿼리의 구조를 머리속에 확실히 학습해야한다.

만약 찾고자하는 도큐먼트의 값이 범위일 때 필요한 것이바로 쿼리 연산자이다. 연산자는 일반 필드와 헷갈리지 않기 위해서 앞에 $표시를 하고있다. 또한 연산자가 포함된 쿼리는 다음과 같이 필드의 값으로 갖는 오브젝트의 키값으로 연산자가들어간다.

{height: {$gte: 175, $lte:180}}


{$or: [ {status: "A"}, {qty: {$lt: 30}}]}


$or 연산자는 또는의 의미가있다. 이 연산자는 쿼리의 필드값으로 연산자가 올수 있고 값으로 배열을 갖고 그 배열안에 쿼리를 넣을 수 있다. $or 연산자로 인해 쿼리의 구조가 복잡하면 쿼리를 읽기가 어려워짐.

실습

1. 강릉시 교차로 내에서 일어난 총 사고의 숫자를 출력한다. 
2. 전국에서 도로 종류 중에 기타단일로에서 사망자수가 0인지역을 출력한다. 

## 3.2 비교논리연산자.

비교연산자는 어떤 값보다 크고 작은지 또는 같고 다른지에 대한 계산을 하는 연산자다.우선 비교 연산자의 종류에대해 파악해보자.


- $eq equals 주어진값과 일치하는 값
- $ne not equal 주어진 값과 일치하지 않는 값
- $gt greater than
- $gte greater than or equals 
- $lt
- $lte
- $in 주어진 배열에 속하는 값
- $nin not in 주어진 배열안에 속하지 않는 값

- $eq 연산자는 연산자를 사용하지 않고 필드: 값으로 적는 것과 같은 효과를 낸다.
- $in, 과 $nin 연산자는 배열을 값으로 갖는 필드에 주로 사용하게된다. 해당 배열안에 연산자 뒤의 값이 모두 포함 / 미포함되는 도큐먼트를 불러오는데, 요소들의 순서를 따지지 않는다는 특징이있다. 


논리 연산자는 쿼리안의 조건들이 논리적 연결을 위해서 존재한다. 단독적으로는 존재할 수 없고 다른 연산자와 연계해서 사용하게된다.

- $not
- $or 
- $and
- $nor 주어진 조건중 하나라도 만족하지 않는 도큐먼를 찾는다.

## 3.3 문자열 연산자

디비에 인간이 읽을수 있는 내용을 저장하기 위해 문자열을 사용해 저장하게된다. 문자열 연산자는 그 수가 비교적 적다. 그중에서 $regex연산자는 문자열의 검색과 치환을 위해 정규표현식을 사용하는 연산자이다. 정규표현식은 특정한 규칙을 가진 문자열의 집합을 표현하는데 사용하는 언어이다. 문자열을 다룰때 필요한 순간이 자주 있기 때문에 정규표현식은 꼭학습해야한다.

> $regex연산자

$regex 연산제에는 옵션값을 설정할 수가 있기 때문에 다른 연산자와는 형식이 조금다르다. 

> $text연산자 

이를 사용하기위해서는 문자열 인덱스를 먼저 만들어야한다. 


## 3.4 배열 연산자

```
db.inventory.insertMany([
    {},
    {}
])
```
배열안의 요소를 검색한다. 
하나의 필드에 여러개의 값을 가지는 것이 배열을 값으로 갖는다는 의미이다. 이 개념을 이해한다면 앞선 쿼리들을 모두 쉽게 이해하고 활용할 수 있다.

배열연산자를 이용해보자.


> $elemMatch 

> $all

순서와 상관없이 모든 요소를 가진다면 그 도큐먼트를 불러온다. 연산자의 값이 모두 포함되면 그 도큐먼트를 불러온다. 

> $size 
> size 연산자는 배열이 해당 크기와 같은 도큐먼트를 찾는다.

## 3.5 프로젝션 연산자 

엄밀하게 말해서 프로젝션이 쿼리 파라미터는 아니지만, 데이터베이스에 질의를 보낼때 프로젝션을 사용하기 때문에 알아보자.

오프젝트 필드 프로젝션

오브젝트를 값으로 갖는 필드에서 내부의 도큐먼트의 특정 필드만 노출시키려면 어떻게할까? 점연산자를 활용한다.

$slice 배열 필드에 주어진 범위만이 보이게한다.
$elemMatch 배열 필드에 해당 조건에 맞는 요소만을 보이게한다. 

`db.inventory.find({}, {tags: {$slice: -2}, _id:false, item:false, qty: false})`

$elemMatch 특정 조건을 만족하는 요소만 노출하게 하고 싶다면 어떻게 할까? 이때 필요한 것이 $elemMatch 연산자와 유사하다. 


마지막으로 달러연산자가있다. 달러연산자를 사용하기 위해서는 달러를 사용하는 필드를 쿼리에 사용해야한다는 조건이있다. 쿼리 조건에 일치했던 첫번째 데이터를 의미한다. 이 연산자를 잘 이용하면 , 배열 안에 들어있는 오브젝트 가운데 쉽게 원하는 것만 노출되게 설정할 수 있다.
