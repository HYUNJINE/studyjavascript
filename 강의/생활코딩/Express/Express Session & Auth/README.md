# Express Session & Auth

쿠키만으로 인증을 구현하면 매우 위험하다.
이메일과 비밀번호는 암호화되지 않고 저장되기 때문이다.
현대적인 어플리케이션들은 쿠키를 사용자를 식별하는데만 사용하고 실제데이터는 서버쪽에 파일이나 데이터베이스의 형태로 구현한다.
세션이 메모리에 저장되면 서버가 껏따 켜지면 다 날라간다. 그러니까 휘발적이지 않은 곳에 저장하는게 좋다.
파일로 세션을 저장하려면
npm i session-file-store 을 이용한다.
사용자가 세션을 가지고 서버로 접속하면, req헤더의 쿠키 값으로 세션아이디를 서버로 전달한다. 그러면 세션 미들웨어가 세션아이디 값을 가지고 세션스토어에서 아이디값에 대응되는 파일을 읽는다.
로그인에 성공했을 때 세션데이터를 만든다.
세션 미들웨어는 메모리에 저장된 세션데이터를 저장소에 반영하는 작업을 한다. 만약 저장소가 느려지고, 리다이렉션이 끝나버리면, 로그인이 안되있다고 되고 나중에 접속하니까 로그인이 되어있다고 표현될수도있다.
이때 req.session.save(콜백함수)를 이용한다. 이함수를 이용하면 세션데이터를 세션 스토어에 바로저장하라고 명령하고, 그 작업이 끝나면 인자로 전달된 콜백을 호출한다. 콜백 함수가 호출되었을 때 리다이렉션을 호출하면, 세션 스토어에 저장된 상태에서 리다이렉션되기 때문에 사용자가 재접속했을 때 정상적으로 동작한다.
