# 왜 리액트인가?

자바스크립트는 영역을 확장하여 서버사이드는 물론, 모바일, 데스크톱 애플리케이션에서도 엄청나게 활약한다.
예를 들어 슬랙, 아톰, vs code 등 유명한 데스크톱 애플리케이션을 일렉트론(자바스크립트로 데스크톱 애플리케이션을 만들수 있는 프레임워크)로 개발되었다.
모바일 애플리케이션도 마찬가지이다.
이런 큰 어플리케이션들을 특별한 도구 없이 순수하게 자바스크립트로만 관리하려면 골치아프다. 지금까지 수많은 프레임워크가 조금씩 다른 관점에서 이를 해결하려고 노력해왔다. Angular,Backbone.js, Derby.js, Ember.js, Ext.js , Knockback.js, Sammy.js, PureMVC, Vue.js 등이 있다.
이 프레임워크들은 주로 MVC(Model-View-Controller) 아키텍처, MVVM(Model-View-View Model) 아키텍처를 사용한다. 이러한 여러 구조의 공통점은 모델과 뷰가 있다는 것이다. 모델은 애플리케이션에서 사용하는 데이터를 관리하는 영역이고, 뷰는 사용자에게 보이는 부분이다. 프로그램이 사용자에게서 어떤 작업을 받으면 컨트롤러는 모델 데이터를 조회하거나 수정하고, 변경된 사항을 뷰에 반영한다.
페이스북 개발팀은 어떤 데이터가 변할 때마다 어떤 변화를 줄지 고민하는 것이 아니라 그냥 기존 뷰를 날려버리고 처음부터 새로 렌더링하는 방식을 고안했다. 이렇게 하면 애플리케이션 구조가 매우 간단하고, 작성해야할 코드양도 많이 줄어든다. 더이상 어떻게 변화를 줄지 신경쓸 필요가 없고, 그저 뷰가 어떻게 생길지 선언하며, 데이터에 변화가 있으면 기존에 것은 그냥 버리고 정해진 규칙에 따라 새로 렌더링하면 된다. 그런데 어떻게 이것이 가능할까? 웹브라우저에서 이 방식대로 하면  CPU점유율도 크게 증가할텐데... DOM은 느리고, 메모리 사용도 많이할것이다. 그리고 사용자가 인풋 박스에 텍스트를 입력할 때 기존에 렌더링된 것은 사라지고, 새로 렌더링하면 끊김 현상이 발생할 것입니다. 페이스북 개발팀이 앞서 설명한 방식으로 최대한 성능을 아끼고 편안한 사용자 경험을 제공하면서 구현하고자 개발한 것이 React이다.

### 리액트의 이해

리액트는 자바스크립트 라이브러리로 사용자 인터페이스를 만드는데 사용한다. 구조가 MVC, MVW등인 프레임워크와 달리, 오직 V만 신경쓰는 라이브러리이다.
리액트 프로젝트에서 특정부분이 어떻게 생길지 정하는 선언체가 있는데, 이를 컴포넌트라고 한다. 컴포넌트는 다른 프레임워크에서사용자 인터페이스를 다룰 때 사용하는 템플릿과는 다른 개념이다. 템플릿은 보통 데이터셋이 주어지면 HTML태그 형식을 문자열로 반환하는데, 이와 달리 컴포넌트는 좀더 복합적인 개념이다. 컴포넌트는 재사용이 가능한 API로 수많은 기능들을 내장하고 있으며, 컴포넌트 하나에서 해당 컴포넌트의 생김새와 작동 방식을 정의한다.

사용자 화면에 뷰를 보여주는 것을 렌더링이라고 한다.리액트 라이브러리는 뷰를 어떻게 렌더링하길래 데이터가 변할 때마다 새롭게 리렌더링하면서 성능을 아끼고, 최적의 사용자 경험을 제공할 수 있을까? 이 비밀을 파악하려면 리액트 컴포넌트가 최초로 실행한 초기렌더링과 컴포넌트의 데이터 변경으로 다시 실행되는 리렌더링 개념을 이해해야 한다.

`초기 렌더링`

어떤 UI관련 프레임워크,라이브러리를 사용하든지 간에 맨 처음 어떻게 보일지를 정하는 초기 렌더링이 필요합니다. 리액트에서는 이를 다루는 render 함수가 있다.
`render() {...}`
이 함수는 컴포넌트가 어떻게 생겼는지 정의하는 역할을 한다. 이 함수는 html형식의 문자열을 반환하지 않고 뷰가 어떻게 생겼고 어떻게 작동하는지에 대한 정보를 지닌 객체를 반환한다.컴포넌트 내부에 또다른 컴포넌트들이 들어갈 수 있다. 이때 render 함수를 실행하면 그 내부에 있는 컴포넌트들도 재귀적으로 렌더링한다.
이렇게 최상위 컴포넌트의 렌더링 작업이 끝나면 지니고 있는 정보들을 사용해 HTML마크업을 만들고, 이를 우리가 정하는 실제 페이지의 DOM요소 안에 주입한다. 컴포넌트를 실제 페이지에 렌더링 할 때는 분리된 두가지 절차를 따르는데, 먼저 문자열 형태의 HTML코드를 생성한 후에 특정 DOM에 해당 내용을 주입하면 이벤트가 적용된다.

`조화 과정`

리액트 라이브러리에서 중요한 부분인 업데이트를 어떻게 진행하는지 한번 알아보자.

우선 리액트에서 뷰를 업데이트 할 때는 업데이트 과정을 거친다라고 하기보다는 조화 과정을 거친다 (reconciliation)라고 하는것이 정확한 표현이다. 컴포넌트에서 데이터에 변화가 있을 때 우리가 보기에는 변화에 따라 뷰가 변형되는 것처럼 보이지만, 사실은 새로운 요소로 갈아 끼우기 때문이다.

이 작업 또한 render 함수가 알아서한다. render 함수는 뷰가 어떻게 생겼고 어떻게 작동하는 객체를 반환하니까 컴포넌트는 데이터를 업데이트 했을 때 단순히 업데이트한 값을 수정하는 것이 아니라, 새로운 데이터를 가지고 render함수를 또 다시 호출한다. 그러면 그 데이터를 지닌 뷰를 생성한다. 하지만 이때 render 함수가 반환하는 결과는 곧바로 DOM에 반영되지 않고 이전에 render가 만들었던 컴포넌트 정보와 현재 render 함수가 만든 컴포넌트 정보를 비교한다. 자바스크립트를 사용하여 두가지 뷰를 최소한의 연산으로 비교한후, 둘의 차이를 알아내 최소한의 연산으로 DOM트리를 업데이트 하는 것이다.

결국 방식 자체는 루트 노드부터 시작하여 전체 컴포넌트를 처음부터 다시 렌더링하는 것처럼 보이지만, 사실 최적의 자원을 사용하여 이를 수행하는 것이다.

## 리액트의 특징

`Virtual DOM`

DOM은 뭘까. Document Object Model 의 약자이다. 객체로 문서 구조를 표현하는 방법으로 XML이나 HTML로 작성한다.
웹 브라우저는 DOM을 활용하여 객체에 자바스크립트와 CSS를 적용한다. DOM은 트리 형태라서 특정노드를 찾거나 수정하거나 제거하거나 원하는 곳에 삽입 할 수 있다.

요즘 DOM API를 수많은 플랫폼과 웹브라우저에서 사용하는데, 이 DOM에는 치명적인 한가지 문제점이있다. 바로 동적 UI에 최적화되어 있지 않다는 것이다. HTML은 자체적으로는 정적이다. 자바스크립트를 사용하여 이를 동적으로 만들수 있다. 하지만 요즘 흔히 접하는 큰 규모의 웹 애플리케이션, 예를 들어 트위터나 페이스북을 생각해 보면 스크롤바를 내릴 수록 수많은 데이터가 로딩된다. 그리고 각 데이터를 표현하는 요소들이 있다. 요소 개수가 몇 백개, 몇 천개 단위로 많다면 이야기는 달라진다. 이렇게 규모가 큰 애플리케이션에서 DOM에 직접 접근하여 변화를 주다보면 성능 이슈가 조금씩 발생하기 시작한다. DOM자체는 빠르다. DOM자체를 읽고 쓸 때의 성능은 자바스크립트 객체를 처리할 때의 성능과 비교하여 다르지 않다. 단 웹 브라우저 단에서 DOM에 변화가 일어나면 웹 브라우저가 CSS를 다시 연산하고, 레이아웃을 구성하고, 페이지를 리페인트한다. 이과정에서 시간이 많이 지연되는 것이다.

HTML마크업을 시각적인 형태로 변환하는 것은 웹 브라우저가 하는 주 역할이기 때문에, 이를 처리할 때 컴퓨터 자원을 사용하는 것은 어쩔 수 없다. DOM을 조작할 때마다 엔진이 웹페이지를 새로 그리기 때문에 업데이트가 너무 잦으면 성능이 저하될 수 있다. DOM을 최소한으로 조작하여 이를 처리하는 방식으로 개선할 수 있다. 
리액트는 virtual DOM 방식을 사용하여 DOM업데이트를 추상화 함으로써 DOM 처리 횟수를 최소화하고 효율적으로 진행한다.

Virtual DOM 을 사용하면 실제 DOM에 접근하여 조작하는 대신, 이를 추상화한 자바스크립트 객체를 구성하여 사용한다. 마치 실제  DOM의  가벼운 사본과 비슷하다. 리액트에서 데이터가 변하여 웹 브라우저에 실제 DOM을 업데이트 할 때는 다음 세가지의 절차를 밟는다.
1. 데이터를 업데이트하면 전체 UI를 Virtual DOM에 리렌더링한다.
2. 이전 virtual DOM 에 있던 내용과 현재 내용으 ㄹ비교한다.
3. 바뀐 부분만 실제 DOM에 적용한다.

Virtual DOM을 사용한다고 해서 사용하지 않을 때와 비교하여 무조건 빠른 것은 아니다. 리액트 메뉴얼에는 다음 문장이 있다.
`우리는 다음 문제를 해결하려고 리액트를 만들었습니다. 지속적으로 데이터가 변화하는 대규모 애플리케이션 구축하기` 결국 적절한 곳에 리액트를 사용해야 리액트가 지닌 진가를 비로소 발휘할 수 있다. 리액트를 사용하지 않아도 코드 최적화를 열심히 하면 DOM 작업이 느려지는 문제를 개선할 수 있고, 또 작업이 매우 간단할 때는 오히려 리액트를 사용하지 않는 편이 더 나은 성능을 보이기도한다.

또 리액트는 다른 웹 프레임워크나 라이브러리와 혼용할 수도 있다. 예를 들어서 Angularjs, Backbone.js 와 언제든지함께 사용가능하다.