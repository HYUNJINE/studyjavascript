# 도커 엔진

## 2.1 도커 이미지와 컨테이너

도커 엔진에서 사용하는 기본단위는 이미지와 컨테이너이며, 이 두가지가 도커 엔진의 핵심이다.

### 2.1.1도커 이미지

이미지는 컨테이너를 생성할 때 필요한 요소이며 가상 머신을 생성할 때 사용하는 iso파일과 비슷한 개념이다. 이미지는 여러 개의 계층으로 된 바이너리 파일로 존재하고 컨테이너를 생성하고 실행할 때 읽기 전용으로 사용된다. 이미지는 도커 명령어로 내려받을수 있으므로 별도로 설치할 필요는 없다.


- 저장소이름은 이미지가 저장된 장소를의미한다. 저장소 이름이 명시되지 않은 이미지는 도커에서 기본적으로 제공하는 이미지 저장소인 도커 허브의 공식 이미지를 뜻한다. 그러나 이미지를 생성할 때 저장소 이름을 명시할 필요는 없으므로 생략하는 경우도 있다.
- 이미지 이름은 해당 이미지가 어떤 역할을 하는지 나타낸다.
- 태그는 이미지의 버전관리 혹은 리비전관리에 사용한다. 일반적으로 버전을생략하면 latest로 인식



### 2.1.2 도커 컨테이너

이러한 이미지로 컨테이너를 생성하면 해당 이미지의 목적에 맞는 파일이 들어있는 파일시스템과 격리된 시스템 자원 및 네트워크를 사용할 수 있는 독립된 공간이 생성되고 이것이바로 도커 컨테이너가된다. 대부분의 도커 컨테이너는 생성될 때 사용된 도커이미지의종류에 따라 알맞은 설정과 파일을 가지고 있기 때문에 도커 이미지의 목적에 맞도록 사용되는 것이 일반적이다. 예를 들어 웹서버 도커이미지로부터 여러개의 컨테이너를 생성하면생성된 컨테이너의 개수만큼 웹서버가 생성되고, 이 컨테이너들은 외부에 웹 서비스를 제공하는데 사용될 것이다.

컨테이너는 이미지를 읽기 전용으로 사용하되 이미지에서 변경된 사항만 컨테이너 계층에 저장하므로 컨테이너에서 무엇을 하든지 원래 이미지는영향을 받지 않는다. 


## 2.2 도커 컨테이너 다루기

### 2.2.1 컨테이너 생성 


docker run 명령어는 컨테이너를 생성하고 실행하는 역할을 한다. ubuntu:14.04 는 컨테이너를 생성하기 위한 이미지 이름이며, -i-t옵션은 컨테이너와 상호 입출력을 가능하게 한다. 이러한 옵션은 뒤에서 다시 설명한다.

`docker run -i -t ubuntu:14.04`

아래 명령어를 입력하면 다음과 같은 내용이 출력된다. 이미지가 로컬 도커 엔진에 존재하지 않으므로 도커 중앙 이미지 저장소인 도커 허브에서 자동으로 이미지를 내려 받는다. 


컨테이너에서 기본 사용자는 root 고 호스트이름은 무작위의 16진수 해시값이다. 무작위의 16진수 해시 값은 컨테이너의 고유한 id의 앞 일부분이다.

docker run 명령어로 컨테이너를 생성할 때 -i 옵션은 상호 입출력을 -t옵션으로 tty를 활성화해서 배시 셸로 사용하도록 컨테이너를 설정한다. 컨테이너와 호스트의 파일 시스템은 독립적이므로 ls명령어로 파일시스템을 확인해보면 아무것도 설치되지 않은 상태임을 확인할 수 있다.

컨테이너 내부에서 호스트의 도커 환경으로 돌아오려면 두가지가있다. 첫번째는 exit을 입력하거나ctrl + D를 입력하는 것이다. 그러나 이방법은 컨테이너 내부에서 빠져나오면서 동시에 컨테이너를 정지시킨다. 여기서는 exit를 이용한다. 

컨테이너를 정지하지 않고 빠져나오는 것으로는 Ctrl + P,Q를 입력하면된다.

이미지를 내려받을 때는 pull명령어를 사용한다.

`docker pull centos:7`

도커엔진에 존재하는 이미지 목록을 보려면 docker images 를 찍는다.

`docker images`

`docker create -i -t --name mycentos centos:7`


create 명령어로 출력된 무작위의 16진수 해시값은 컨테이너의 고유id이다. 그러나 너무 길어 일반적으로 앞의 12자리만 사용한다. docker inspect 명령어로 컨테이너의 id를 다시 확인할 수 있다.

이번에는 run 명령어를 실행했을 때와 달리 컨테이너 내부로 들어가지 않는다. create 명령어는 ㅓㄴ테이너를 생성만 할 뿐 컨테이너로 들어가지는 않는다.

docker start 명령어와 docker attach 명령어를 써서 컨테이너를 시작하고 내부로 들어갈 수 있다. attach 명령어는 컨테이너 내부로 들어가는 명령이다.




