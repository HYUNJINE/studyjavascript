- 큰그림을 서로 다른 작은 아키텍처 문제로 쪼개는 방법
- 테스트 더블(모킹)로 코드베이스의 다른 컴포넌트와 상호작용을 고립하고 테스트하는 방법
- 요구 사항이 응용프로그램 도메인 코어로 이어지도록 뒤집어 생각하는 방법


## 6.3 트우터 요구사항

사용자가 게시하는 각각의 마이크로 블로그를 트옷이라고 부르며 사용자는 연속적인 트웃 스트림을 갖는다. 다른 사용자를 팔로우해야 그 사용자가 무엇을 트우팅했는지 알 수 있다.

- 고유의 사용자 ID와 비밀번호로 트우터에 로그인
- 각 사용자는 자신이 팔로우하는 사용자 집합을 갖는다.
- 사용자는 트옷을 전송할 수 있으며 로그인한 모든 팔로워는 이 트옷을 바로 볼수있다.
- 사용자가 로그인하면 최종 로그인한 이후로 게시된 팔로워의 모든 트옷을 볼 수 있다.
- 자신의 트옷을 삭제할 수 있다. 
- 사용자는 모바일이나 웹사이트로 로그인 할 수 있다.

## 6.4 설계 개요

### 6.4.1 풀 기반

풀기반 통신에서는 클라이언트가 서버로 정보를 요청한다. 풀기반 통신은 점대점또는 요청응답 통신 형식으로 불린다. 대부분의 웹에서 이 통신형식을 사용한다. 웹사이트에 접속할 때 클라이언트는 서버로 HTTP 요청을 보내 페이지의 데이터를 가져온다. 클라이언트가 어떤 정보를 로딩할지 결정하는 상황이라면 특히 풀기반 통신이 유용하다. 예를 들어 여러분이 위키백과를 탐색하면서 관심있는 페이지를 선택하거나 다음 페이지를 선택하면 여러분의 선택에따라 요청한 내용이 응답으로 제공된다. 

### 6.4.2 푸시 기반

푸시기반 통신 방법도 있다. 이를 리액티브 또는 이벤트 주도 통신이라고 부른다. 푸시기반 모ㅔㄷㄹ에서는 작성자가 방출한 이벤트 스트림을 여러 구독자가 수신한다. 따라서 이모델은 일대일 통신뿐아니라 일대 다 통신도 지원한다. 푸시기반 통신은 여러 컴포넌트 간에 다양한 이벤트의 의사소통이 발생하는 상황에서 특히 유용하다. 예를 들어 주식시장 거래 프로그램을 설계할 때 다양한회사의 가격과 틱 정보가 필요할 때마다 요청하는 것이아니라 연속적으로 정보가 제공되어야한다. 트우터에서는 트웃의 스트림이 주를 이루므로 이벤트 주도 통신 형식이 가장 적합하다. 이모델에서 이벤트는 트웃이다. 물론 요청 응답 통신 형식으로도 응용프로그램을 설계할 수 있다. 하지만 사용자가 지난번 데이터를 요청한 이후로 누군가 트웃을 날린 사용자가 있나요라고 물으면 서버에서 정기적으로 데이터를 요청해야한다. 이벤트 주도 형식에서는 다른 사용자를 팔로우 즉 이벤트를 구독하면 사용자가 구독한 관심 트웃을 서버가 클라이언트로 푸시한다.


### 6.5.1 통신

- 웹 소캣은 TCP 스트림으로 양방향 이벤트 통신을 지원하는 가벼운 통신 프로토콜이다. 최신 브라우저에서 지원하는 웹 서버와 웹 브라우저 사이의 이벤트 주도 통신에 주로 사용된다.
- 요즘은 아마존 단순 큐서비스같은 호스트된 클라우드 기반 메시지 큐를 메시지 송출이나 수신에 점점 많이 사용한다. 메시지 큐는 그룹내의 프로세스 중 한 프로세스가 전송된 메시지를 받아 처리하는 상호 프로세스 통신 방식이다. 호스트된 서비스를 이용하면 안정적인 호스팅을 제공하기 위해 직접 관리하지 않아도 되므로 편리하다.
- 메시지 전송이나 메시지 큐를 구현하는 오픈소스인 Aeron,ZeroMQ, AMPQ로 구현하는 방법도 있다. 오픈소스프로젝트는 특정 회사에 의존하지 않는다는 장점이있는 반면, 메시지 큐로 상호작용할 수 있는 클라이언트 선택에 제한이 있을 수 있다. 예를 들어서 클라이언트가 웹 브라우저라면 오픈 소스 구현을 선택하지 않는 것이 좋다.

### 6.5.2 GUI

UI 통신 기술이나 UI 서버의 비즈니스 로직과 결합하면 몇가지 단점이 발생한다.

### 6.5.3 영구 저장

그렇다면 트우터는 수신한 데이터를 어떻게 저장할까? 다음과 같은 기술을 사용해 데이터를 저장할 수 있다.

직접 인덱스하고 검색할 수 있는 기반 텍스트파일

- 전통적 SQL 데이터베이스: 모두가 잘 알고있으며 잘 검증된 시스템으로 강력한 질의를 지원한다.
- NoSQL데이터베이트 : 다양한 유스케이스 질의 언어, 데이터 저장모델을 지원하는 여러 데이터베이스가 있다.


### 6.5.4 육각형 아키텍처

포트와 어댑터를 추상화. 나주엥 트우터에 노티피케이션 시스템을 확장할 계획도 있다. 사용자가 관심이 있는 트옷을 로그인해서 볼수 있도록 알리고 보여주는 기능은 포트에 해당한다. 이 기능을 이메일이나 텍스트 메시지의 어댑터로 구현할 수 있다. 인증 서비스에서도 포트를 활용할 수 있다. 처음에는 사용자명과 비밀번호를 저장하는 어댑터를 구현하고 나중에는 이를 OAuth 백엔드나 다른 종류의 시스템으로 바꿀 수있다. 어떤 기능을 포트로 지정하고 어떤 기능을 코어 도메인 으로 분리해야하는지 궁금해진다. 극단적으로 응용프로그램에 수백또는 수천개의 포트를 지정해서 거의 모든 코어 도메인 기능을 추상화할 수 있다. 극단적인 반대 상황으로는 어떤 기능도 포트로 지정하지 않을 수도 있다. 정해진 규칙은 따로 없으므로 개인적인 판단과 환경에 따라 응용프로그램에 맞는 결정을 하면 된다.

비즈니스 문제를 해결하는데 꼭 필요한 기능을 응용프로글매의 코어로 분류하고 나머지 특정 기술에 종속된 기능이나 통신관련 기능은 코어 응용 프로그램의 외부 세계로 분류하는 것이 일반적인 관계이다. 

## 6.6 작업 순서

## 6.7 비밀번호와 보안

보안을 잘 이해하고 있는 기관이라면 자신의 소프트웨어를 정기적으로 검토하고 분석하는 계획을 세운다. 예를 들어 외부 컨설턴트나 내부 팀이 해커의 역할을 맡아 주기적으로 시스템 보안을 침투하도록 실험한다.


